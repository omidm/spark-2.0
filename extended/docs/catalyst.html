<!DOCTYPE html>
<html class="" prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# article: http://ogp.me/ns/article#" lang="en-US"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8"><script src="Deep%20Dive%20into%20Spark%20SQL%E2%80%99s%20Catalyst%20Optimizer_files/cc545fdb66" type="text/javascript"></script><script src="Deep%20Dive%20into%20Spark%20SQL%E2%80%99s%20Catalyst%20Optimizer_files/nr-963.js"></script><script src="Deep%20Dive%20into%20Spark%20SQL%E2%80%99s%20Catalyst%20Optimizer_files/ip.js" id="db_ip_api" async=""></script><script src="Deep%20Dive%20into%20Spark%20SQL%E2%80%99s%20Catalyst%20Optimizer_files/fbevents.js" async=""></script><script src="Deep%20Dive%20into%20Spark%20SQL%E2%80%99s%20Catalyst%20Optimizer_files/438089.js" id="hs-analytics"></script><script src="Deep%20Dive%20into%20Spark%20SQL%E2%80%99s%20Catalyst%20Optimizer_files/xoRL8eto.js" id="demandbase_js_lib" async=""></script><script src="Deep%20Dive%20into%20Spark%20SQL%E2%80%99s%20Catalyst%20Optimizer_files/conversion_async.js" async="" type="text/javascript"></script>
  
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge"><script src="Deep%20Dive%20into%20Spark%20SQL%E2%80%99s%20Catalyst%20Optimizer_files/gtm.js" async=""></script><script src="Deep%20Dive%20into%20Spark%20SQL%E2%80%99s%20Catalyst%20Optimizer_files/analytics.js" async=""></script><script type="text/javascript">window.NREUM||(NREUM={}),__nr_require=function(t,e,n){function r(n){if(!e[n]){var o=e[n]={exports:{}};t[n][0].call(o.exports,function(e){var o=t[n][1][e];return r(o||e)},o,o.exports)}return e[n].exports}if("function"==typeof __nr_require)return __nr_require;for(var o=0;o<n.length;o++)r(n[o]);return r}({1:[function(t,e,n){function r(){}function o(t,e,n){return function(){return i(t,[(new Date).getTime()].concat(u(arguments)),e?null:this,n),e?void 0:this}}var i=t("handle"),a=t(2),u=t(3),c=t("ee").get("tracer"),f=NREUM;"undefined"==typeof window.newrelic&&(newrelic=f);var s=["setPageViewName","setCustomAttribute","finished","addToTrace","inlineHit"],p="api-",l=p+"ixn-";a(s,function(t,e){f[e]=o(p+e,!0,"api")}),f.addPageAction=o(p+"addPageAction",!0),e.exports=newrelic,f.interaction=function(){return(new r).get()};var d=r.prototype={createTracer:function(t,e){var n={},r=this,o="function"==typeof e;return i(l+"tracer",[Date.now(),t,n],r),function(){if(c.emit((o?"":"no-")+"fn-start",[Date.now(),r,o],n),o)try{return e.apply(this,arguments)}finally{c.emit("fn-end",[Date.now()],n)}}}};a("setName,setAttribute,save,ignore,onEnd,getContext,end,get".split(","),function(t,e){d[e]=o(l+e)}),newrelic.noticeError=function(t){"string"==typeof t&&(t=new Error(t)),i("err",[t,(new Date).getTime()])}},{}],2:[function(t,e,n){function r(t,e){var n=[],r="",i=0;for(r in t)o.call(t,r)&&(n[i]=e(r,t[r]),i+=1);return n}var o=Object.prototype.hasOwnProperty;e.exports=r},{}],3:[function(t,e,n){function r(t,e,n){e||(e=0),"undefined"==typeof n&&(n=t?t.length:0);for(var r=-1,o=n-e||0,i=Array(o<0?0:o);++r<o;)i[r]=t[e+r];return i}e.exports=r},{}],ee:[function(t,e,n){function r(){}function o(t){function e(t){return t&&t instanceof r?t:t?u(t,a,i):i()}function n(n,r,o){t&&t(n,r,o);for(var i=e(o),a=l(n),u=a.length,c=0;c<u;c++)a[c].apply(i,r);var s=f[m[n]];return s&&s.push([w,n,r,i]),i}function p(t,e){g[t]=l(t).concat(e)}function l(t){return g[t]||[]}function d(t){return s[t]=s[t]||o(n)}function v(t,e){c(t,function(t,n){e=e||"feature",m[n]=e,e in f||(f[e]=[])})}var g={},m={},w={on:p,emit:n,get:d,listeners:l,context:e,buffer:v};return w}function i(){return new r}var a="nr@context",u=t("gos"),c=t(2),f={},s={},p=e.exports=o();p.backlog=f},{}],gos:[function(t,e,n){function r(t,e,n){if(o.call(t,e))return t[e];var r=n();if(Object.defineProperty&&Object.keys)try{return Object.defineProperty(t,e,{value:r,writable:!0,enumerable:!1}),r}catch(i){}return t[e]=r,r}var o=Object.prototype.hasOwnProperty;e.exports=r},{}],handle:[function(t,e,n){function r(t,e,n,r){o.buffer([t],r),o.emit(t,e,n)}var o=t("ee").get("handle");e.exports=r,r.ee=o},{}],id:[function(t,e,n){function r(t){var e=typeof t;return!t||"object"!==e&&"function"!==e?-1:t===window?0:a(t,i,function(){return o++})}var o=1,i="nr@id",a=t("gos");e.exports=r},{}],loader:[function(t,e,n){function r(){if(!h++){var t=y.info=NREUM.info,e=s.getElementsByTagName("script")[0];if(t&&t.licenseKey&&t.applicationID&&e){c(m,function(e,n){t[e]||(t[e]=n)});var n="https"===g.split(":")[0]||t.sslForHttp;y.proto=n?"https://":"http://",u("mark",["onload",a()],null,"api");var r=s.createElement("script");r.src=y.proto+t.agent,e.parentNode.insertBefore(r,e)}}}function o(){"complete"===s.readyState&&i()}function i(){u("mark",["domContent",a()],null,"api")}function a(){return(new Date).getTime()}var u=t("handle"),c=t(2),f=window,s=f.document,p="addEventListener",l="attachEvent",d=f.XMLHttpRequest,v=d&&d.prototype;NREUM.o={ST:setTimeout,CT:clearTimeout,XHR:d,REQ:f.Request,EV:f.Event,PR:f.Promise,MO:f.MutationObserver},t(1);var g=""+location,m={beacon:"bam.nr-data.net",errorBeacon:"bam.nr-data.net",agent:"js-agent.newrelic.com/nr-963.min.js"},w=d&&v&&v[p]&&!/CriOS/.test(navigator.userAgent),y=e.exports={offset:a(),origin:g,features:{},xhrWrappable:w};s[p]?(s[p]("DOMContentLoaded",i,!1),f[p]("load",r,!1)):(s[l]("onreadystatechange",o),f[l]("onload",r)),u("mark",["firstbyte",a()],null,"api");var h=0},{}]},{},["loader"]);</script>
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

<title>Deep Dive into Spark SQL’s Catalyst Optimizer</title>

<link rel="profile" href="http://gmpg.org/xfn/11">
<link rel="pingback" href="https://databricks.com/xmlrpc.php">
<link rel="mask-icon" href="https://databricks.com/mask-icon.svg" color="#FD3A1C">
<link rel="apple-touch-icon" sizes="57x57" href="https://databricks.com/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="https://databricks.com/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="https://databricks.com/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="https://databricks.com/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="https://databricks.com/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="https://databricks.com/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="https://databricks.com/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="https://databricks.com/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="https://databricks.com/apple-touch-icon-180x180.png">
<link rel="icon" type="image/png" href="https://databricks.com/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="https://databricks.com/android-chrome-192x192.png" sizes="192x192">
<link rel="icon" type="image/png" href="https://databricks.com/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="https://databricks.com/favicon-16x16.png" sizes="16x16">
<link rel="manifest" href="https://databricks.com/manifest.json">
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="msapplication-TileImage" content="/mstile-144x144.png">
<meta name="theme-color" content="#ffffff">


<!-- SEO Ultimate (http://www.seodesignsolutions.com/wordpress-seo/) -->
	<meta property="og:type" content="article">
	<meta property="og:title" content="Deep Dive into Spark SQL’s Catalyst Optimizer">
	<meta property="og:url" content="https://databricks.com/blog/2015/04/13/deep-dive-into-spark-sqls-catalyst-optimizer.html">
	<meta property="og:image" content="https://databricks.com/wp-content/uploads/2016/03/default-open-graph.png">
	<meta property="article:published_time" content="2015-04-13">
	<meta property="article:modified_time" content="2016-04-01">
	<meta property="article:author" content="https://databricks.com/blog/author/michael">
	<meta property="article:tag" content="Apache Spark">
	<meta property="article:tag" content="Engineering Blog">
	<meta property="article:tag" content="Open Source">
	<meta property="og:site_name" content="Databricks">
	<meta name="twitter:card" content="summary">
	<meta name="twitter:site" content="@databricks">
	<meta name="twitter:site:id" content="1562518867">
	<meta name="google-site-verification" content="8yr1FGaP6qSpZy8Zu4rpiwcmltb-ajA1JryVMTeqTlk">
	<meta name="msvalidate.01" content="6F98CDA75F877AEB623786A4F4249F2C">

<!-- Code Inserter module -->
<!-- hello -->
<!-- /Code Inserter module -->

<!-- /SEO Ultimate -->

<link rel="dns-prefetch" href="https://databricks.com/">
<link rel="dns-prefetch" href="https://cdn.rawgit.com/">
<link rel="dns-prefetch" href="https://s.w.org/">
<link rel="stylesheet" id="databricks-css-bootstrap-css" href="Deep%20Dive%20into%20Spark%20SQL%E2%80%99s%20Catalyst%20Optimizer_files/bootstrap.css" type="text/css" media="all">
<link rel="stylesheet" id="databricks-css-fancybox-css" href="Deep%20Dive%20into%20Spark%20SQL%E2%80%99s%20Catalyst%20Optimizer_files/jquery.css" type="text/css" media="all">
<link rel="stylesheet" id="databricks-css-main-css" href="Deep%20Dive%20into%20Spark%20SQL%E2%80%99s%20Catalyst%20Optimizer_files/main.css" type="text/css" media="all">
<link rel="https://api.w.org/" href="https://databricks.com/wp-json/">
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://databricks.com/xmlrpc.php?rsd">
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://databricks.com/wp-includes/wlwmanifest.xml"> 
<link rel="prev" title="A Look Back at Spark Summit East" href="https://databricks.com/blog/2015/04/08/a-look-back-at-spark-summit-east.html">
<link rel="next" title="Running Apache Spark GraphX algorithms on Library of Congress subject heading SKOS" href="https://databricks.com/blog/2015/04/14/running-spark-graphx-algorithms-on-library-of-congress-subject-heading-skos.html">
<meta name="generator" content="WordPress 4.6">
<link rel="canonical" href="https://databricks.com/blog/2015/04/13/deep-dive-into-spark-sqls-catalyst-optimizer.html">
<link rel="shortlink" href="https://databricks.com/?p=3375">
<link rel="alternate" type="application/json+oembed" href="https://databricks.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fdatabricks.com%2Fblog%2F2015%2F04%2F13%2Fdeep-dive-into-spark-sqls-catalyst-optimizer.html">
<link rel="alternate" type="text/xml+oembed" href="https://databricks.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fdatabricks.com%2Fblog%2F2015%2F04%2F13%2Fdeep-dive-into-spark-sqls-catalyst-optimizer.html&amp;format=xml">
<!-- Google Analytics Tracking by Google Analyticator 6.4.9: http://www.videousermanuals.com/google-analyticator/ -->
<script type="text/javascript">
    var analyticsFileTypes = [''];
    var analyticsSnippet = 'disabled';
    var analyticsEventTracking = 'enabled';
</script>
<script type="text/javascript">
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-44077918-1', 'auto');
 
	ga('send', 'pageview');
</script>
<link href="Deep%20Dive%20into%20Spark%20SQL%E2%80%99s%20Catalyst%20Optimizer_files/prettify.css" type="text/css" rel="stylesheet"><style type="text/css">.fancybox-margin{margin-right:15px;}</style><style type="text/css"></style></head>
<body class="single single-post postid-3375 single-format-standard loaded has-email-tab-component">
  <div class="body-header">
  <div class="body-header--topbar">
    <div class="body-header--topbar-container container">
      <ul class="body-header--topbar-menu nav">
        <li class="menu-item body-header--topbar-menu--search">
          <a href="#" data-toggle="collapse" data-target="#body-header-desktop-search-collapse" title="Search" class="body-header--topbar-menu--search-toggle collapsed">
            <span class="db-icon-search"></span>
            <span class="sr-only">Toggle Search</span>
          </a>

          <div id="body-header-desktop-search-collapse" class="body-header--topbar-menu--search-form collapse js-desktop-search-collapse">
            <div class="snippet_search_form">
<form class="form form-search" action="/" method="get">
    <div class="form-group">
    <label class="form-search-label" for="search-1">Search</label>
    <input class="form-search-field form-control" name="s" id="search-1" placeholder="Search" type="text">
  </div>
  <button class="form-search-submit btn" type="submit">
    <span class="form-search-submit-text">Search</span>
  </button>
</form>
</div>          </div>
        </li>

        <li id="menu-item-7110" class="no-highlight menu-item menu-item-type-post_type menu-item-object-page menu-item-7110"><a href="https://databricks.com/spark/training">Training</a></li>
<li id="menu-item-7111" class="no-highlight menu-item menu-item-type-post_type menu-item-object-page menu-item-7111"><a href="https://databricks.com/company/partners">Partners</a></li>

        <li class="body-header--topbar-menu--btn">
          <a href="https://accounts.cloud.databricks.com/registration.html#login" aria-label="Manage Account" data-track-button-click-event="Main Menu Manage Account CTA">Manage Account</a>
        </li><li class="body-header--topbar-menu--btn body-header--topbar-menu--btn-primary">
          <a href="https://databricks.com/try-databricks" aria-label="Try Databricks" data-track-button-click-event="Main Menu Signup CTA">Try Databricks</a>
        </li>
      </ul>
    </div>
  </div>

  <nav class="body-header--navbar navbar">
    <div class="body-header--navbar-container container">
      <div class="body-header--navbar-header">
        <div class="body-header--navbar-header--brand">          <a href="https://databricks.com/">
            <span class="sr-only">Databricks, Inc</span>
          </a>
        </div>
        <button type="button" class="body-header--navbar-header--toggle body-header--navbar-toggle--mobile-menu js-toggle-mobile-header-menu">
          <span class="db-icon-menu"></span>
          <span class="sr-only">Toggle navigation</span>
        </button>
      </div>

      <div class="body-header--navbar-menu js-mobile-header-menu">
        <div class="body-header--navbar-menu--inner">
          <div class="body-header--navbar-menu--mobile-search">
            <div class="snippet_search_form">
<form class="form form-search" action="/" method="get">
    <div class="form-group">
    <label class="form-search-label" for="search-2">Search</label>
    <input class="form-search-field form-control" name="s" id="search-2" placeholder="Search" type="text">
  </div>
  <button class="form-search-submit btn" type="submit">
    <span class="form-search-submit-text">Search</span>
  </button>
</form>
</div>          </div>

          <ul class="nav body-header--navbar-menu--menu body-header--navbar-menu--menu-left allow-dropdown-hover">
            <li class="body-header--navbar-menu--btn body-header--navbar-menu--btn-primary visible-xs menu-item">
              <a href="https://databricks.com/try-databricks" aria-label="Try Databricks" data-track-button-click-event="Main Menu Signup CTA">Try Databricks</a>
            </li>
            <li class="body-header--navbar-menu--btn visible-xs menu-item">
              <a href="https://accounts.cloud.databricks.com/registration.html#login" aria-label="Manage Account" data-track-button-click-event="Main Menu Manage Account CTA">Manage Account</a>
            </li>

            <li id="menu-item-7076" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-7076 dropdown"><a href="https://databricks.com/product/databricks" data-toggle="dropdown" class="dropdown-toggle" aria-haspopup="true">Product <span class="caret"></span></a>
<ul role="menu" class=" dropdown-menu">
	<li id="menu-item-7077" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-7077"><a href="https://databricks.com/product/databricks">Databricks</a></li>
	<li id="menu-item-8128" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-8128"><a href="https://databricks.com/product/getting-started-with-apache-spark-on-databricks">How to Get Started</a></li>
	<li id="menu-item-7079" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-7079"><a href="https://databricks.com/product/pricing">Pricing</a></li>
	<li id="menu-item-7080" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-7080"><a href="https://databricks.com/product/security">Security</a></li>
	<li id="menu-item-8178" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-8178"><a href="https://docs.cloud.databricks.com/docs/latest/api/index.html">API Documentation</a></li>
	<li id="menu-item-7078" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-7078"><a href="https://databricks.com/product/faq">FAQ</a></li>
	<li id="menu-item-4032" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-4032"><a href="https://forums.databricks.com/">Forums</a></li>
	<li id="menu-item-7081" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-7081"><a href="https://databricks.com/academic">Academic Program</a></li>
</ul>
</li>
<li id="menu-item-7082" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-7082 dropdown"><a href="https://databricks.com/spark/about" data-toggle="dropdown" class="dropdown-toggle" aria-haspopup="true">Apache Spark <span class="caret"></span></a>
<ul role="menu" class=" dropdown-menu">
	<li id="menu-item-7083" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-7083"><a href="https://databricks.com/spark/about">About Apache Spark</a></li>
	<li id="menu-item-4688" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-4688"><a href="http://sparkhub.databricks.com/">SparkHub (Community)</a></li>
	<li id="menu-item-7767" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-7767"><a href="https://sparkhub.databricks.com/resources/">Developer Resources</a></li>
	<li id="menu-item-7084" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-7084"><a href="https://databricks.com/spark/certification">Certification</a></li>
	<li id="menu-item-7086" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-7086"><a href="https://databricks.com/spark/training">Training</a></li>
</ul>
</li>
<li id="menu-item-7087" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-7087 dropdown"><a href="https://databricks.com/solutions/by-role" data-toggle="dropdown" class="dropdown-toggle" aria-haspopup="true">Solutions <span class="caret"></span></a>
<ul role="menu" class=" dropdown-menu">
	<li id="menu-item-7089" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-7089"><a href="https://databricks.com/solutions/by-role">By Role</a></li>
	<li id="menu-item-7088" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-7088"><a href="https://databricks.com/solutions/by-industry">By Industry</a></li>
	<li id="menu-item-7090" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-7090"><a href="https://databricks.com/solutions/by-use-case">By Use Case</a></li>
</ul>
</li>
<li id="menu-item-7091" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-7091"><a href="https://databricks.com/customers">Customers</a></li>
<li id="menu-item-7092" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-7092 dropdown"><a href="https://databricks.com/company/about-us" data-toggle="dropdown" class="dropdown-toggle" aria-haspopup="true">Company <span class="caret"></span></a>
<ul role="menu" class=" dropdown-menu">
	<li id="menu-item-7093" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-7093"><a href="https://databricks.com/company/about-us">About Us</a></li>
	<li id="menu-item-7096" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-7096"><a href="https://databricks.com/company/leadership-team">Leadership</a></li>
	<li id="menu-item-7097" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-7097"><a href="https://databricks.com/company/team">Team</a></li>
	<li id="menu-item-7099" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-7099"><a href="https://databricks.com/company/partners">Partners</a></li>
	<li id="menu-item-7098" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-7098"><a href="https://databricks.com/company/newsroom">Newsroom</a></li>
	<li id="menu-item-7094" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-7094"><a href="https://databricks.com/company/careers">Careers</a></li>
	<li id="menu-item-7095" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-7095"><a href="https://databricks.com/company/contact">Contact</a></li>
</ul>
</li>
<li id="menu-item-7100" class="menu-item menu-item-type-post_type menu-item-object-page current_page_parent menu-item-has-children menu-item-7100 dropdown current-menu-ancestor"><a href="https://databricks.com/blog" data-toggle="dropdown" class="dropdown-toggle" aria-haspopup="true">Blog <span class="caret"></span></a>
<ul role="menu" class=" dropdown-menu">
	<li id="menu-item-7101" class="menu-item menu-item-type-post_type menu-item-object-page current_page_parent menu-item-7101"><a href="https://databricks.com/blog">See All</a></li>
	<li id="menu-item-6963" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6963"><a href="https://databricks.com/blog/category/company">Company Blog</a></li>
	<li id="menu-item-6964" class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-6964"><a href="https://databricks.com/blog/category/engineering">Engineering Blog</a></li>
</ul>
</li>
<li id="menu-item-8835" class="resource menu-item menu-item-type-resource menu-item-object-cpt_archive menu-item-8835"><a href="https://databricks.com/resources">Resources</a></li>
          </ul>

          <ul class="nav body-header--navbar-menu--menu body-header--navbar-menu--menu-right allow-dropdown-hover">
            <li class="no-highlight menu-item menu-item-type-post_type menu-item-object-page menu-item-7110"><a href="https://databricks.com/spark/training">Training</a></li>
<li class="no-highlight menu-item menu-item-type-post_type menu-item-object-page menu-item-7111"><a href="https://databricks.com/company/partners">Partners</a></li>
          </ul>
        </div>
      </div>
    </div>
  </nav>

  <div class="body-header--mobile-navbar-overlay js-toggle-mobile-header-menu"></div>
</div><!-- .body-header -->
<div class="body-content">
<div class="page-container container">
<div class="page-section blog-page-section">
  <div class="row">
          <div class="col-xs-12 col-sm-3 col-md-2">
        <div class="blog-sidebar blog-sidebar--menu">
  <div class="blog-sidebar--section blog-sidebar--menu--section-search hidden-xs">
    <div class="snippet_search_form">
<form class="form form-search" action="/" method="get">
    <div class="form-group">
    <label class="form-search-label" for="search-3">Search</label>
    <input class="form-search-field form-control" name="s" id="search-3" placeholder="Search Blog" type="text">
  </div>
  <button class="form-search-submit btn" type="submit">
    <span class="form-search-submit-text">Search</span>
  </button>
</form>
</div>  </div>

      <div class="blog-sidebar--section blog-sidebar--menu--section-navigation">
      <div class="blog-sidebar--menu--section-navigation--collapse collapse collapse-simple" id="blog-sidebar--menu-navigation-collapse" aria-expanded="false" style="height:0">
        <div class="blog-sidebar--menu--section-navigation--collapse--inner">
          <ul id="menu-blog-menu-1" class="blog-sidebar--menu--section-navigation--menu"><li class="company menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children menu-item-6951"><a href="https://databricks.com/blog/category/company">Company <span class="hidden-xs">Blog</span></a>
<ul class="sub-menu">
	<li id="menu-item-6952" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6952"><a href="https://databricks.com/blog/category/company/announcements">Announcements</a></li>
	<li id="menu-item-6953" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6953"><a href="https://databricks.com/blog/category/company/customers">Customers</a></li>
	<li id="menu-item-6954" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6954"><a href="https://databricks.com/blog/category/company/events">Events</a></li>
	<li id="menu-item-6955" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6955"><a href="https://databricks.com/blog/category/company/partners">Partners</a></li>
	<li id="menu-item-6956" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6956"><a href="https://databricks.com/blog/category/company/product">Product</a></li>
</ul>
</li>
<li class="engineering menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-has-children menu-item-6957"><a href="https://databricks.com/blog/category/engineering">Engineering <span class="hidden-xs">Blog</span></a>
<ul class="sub-menu">
	<li id="menu-item-6958" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6958"><a href="https://databricks.com/blog/category/engineering/ecosystem">Ecosystem</a></li>
	<li id="menu-item-6959" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6959"><a href="https://databricks.com/blog/category/engineering/machine-learning">Machine Learning</a></li>
	<li id="menu-item-6960" class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-6960"><a href="https://databricks.com/blog/category/engineering/spark">Apache Spark</a></li>
	<li id="menu-item-6961" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6961"><a href="https://databricks.com/blog/category/engineering/streaming">Streaming</a></li>
</ul>
</li>
<li class="menu-item"><a href="https://databricks.com/blog"><span class="hidden-xs">See </span>All</a></li></ul>
          <a class="blog-sidebar--menu--section-navigation--collapse--twitter-icon visible-xs" href="https://twitter.com/databricks" target="_blank">
            <span class="db-icon-twitter"></span>
          </a>
        </div>
      </div>
      <a class="blog-sidebar--menu--section-navigation--collapse-toggle collapsed visible-xs" role="button" data-toggle="collapse" href="#blog-sidebar--menu-navigation-collapse">
        <span class="blog-sidebar--menu--section-navigation--collapse-toggle--bar"></span>
        <span class="blog-sidebar--menu--section-navigation--collapse-toggle--bar"></span>
        <span class="blog-sidebar--menu--section-navigation--collapse-toggle--bar"></span>
        <span class="sr-only">Collapse</span>
      </a>
    </div>
  
  <div class="blog-sidebar--section blog-sidebar--menu--section-subscribe hidden-xs">
    <h4 class="blog-sidebar--section--title">Subscribe</h4>

    <ul class="blog-sidebar--menu--section-subscribe--links">
      <li>
        <a class="blog-sidebar--menu--section-subscribe--links--link" href="https://databricks.com/feed" title="Databricks Blog RSS feed" target="_blank">
          <span class="blog-sidebar--menu--section-subscribe--links--link--icon db-icon-rss"></span>
          <span class="blog-sidebar--menu--section-subscribe--links--link--label">Blog</span>
        </a>
      </li>
      <li>
        <a class="blog-sidebar--menu--section-subscribe--links--link" href="http://go.databricks.com/newsletter-registration" title="Databricks Newsletter" target="_blank">
          <span class="blog-sidebar--menu--section-subscribe--links--link--icon db-icon-newsletter"></span>
          <span class="blog-sidebar--menu--section-subscribe--links--link--label">Newsletter</span>
        </a>
      </li>
    </ul>
  </div>

  <div class="blog-sidebar--section blog-sidebar--menu--section-follow hidden-xs">
    <h4 class="blog-sidebar--section--title">Follow</h4>

    <ul class="blog-sidebar--menu--section-follow--links navbar-share">
      <li>
        <a class="blog-sidebar--menu--section-follow--links--link" href="https://twitter.com/databricks" target="_blank">
          <span class="db-icon-twitter blog-sidebar--menu--section-follow--links--link--icon"></span>
          <span class="sr-only">Databricks Twitter profile</span>
        </a>
      </li>
      <li>
        <a class="blog-sidebar--menu--section-follow--links--link" href="https://www.linkedin.com/company/databricks" target="_blank">
          <span class="db-icon-linkedin blog-sidebar--menu--section-follow--links--link--icon"></span>
          <span class="sr-only">Databricks LinkedIn profile</span>
        </a>
      </li>
      <li>
        <a class="blog-sidebar--menu--section-follow--links--link" href="https://www.facebook.com/pages/Databricks/560203607379694" target="_blank">
          <span class="db-icon-facebook blog-sidebar--menu--section-follow--links--link--icon"></span>
          <span class="sr-only">Databricks Facebook profile</span>
        </a>
      </li>
    </ul>
  </div>
</div>
      </div>
    
    <div class="col-xs-12 col-sm-9 col-md-7">
      <div class="blog-content">
                <div class="blog-post blog-post-single blog-post-category-engineering">
  <header class="blog-post--header">
          <h1 class="blog-post--header--title">Deep Dive into Spark SQL’s Catalyst Optimizer</h1>
          
    <div class="blog-post--header--meta">
                        <span class="blog-post--header--meta--item blog-post--header--meta--item-date visible-xs-inline">
            <a href="https://databricks.com/blog/2015/04/13/deep-dive-into-spark-sqls-catalyst-optimizer.html"><time datetime="2015-04-13T07:30:44+00:00">April 13, 2015</time></a>
          </span>
          <span class="blog-post--header--meta--item blog-post--header--meta--item-author-avatars hidden-xs">
                        <a href="https://databricks.com/blog/author/michael" class="blog-post--header--meta--item-author-avatars--avatar"><img src="Deep%20Dive%20into%20Spark%20SQL%E2%80%99s%20Catalyst%20Optimizer_files/michaelA-128x128.jpg" alt="Michael Armbrust" class="avatar avatar-100 wp-user-avatar wp-user-avatar-100 alignnone photo" height="100" width="100"></a><a href="https://databricks.com/blog/author/yin-huai" class="blog-post--header--meta--item-author-avatars--avatar"><img src="Deep%20Dive%20into%20Spark%20SQL%E2%80%99s%20Catalyst%20Optimizer_files/yinH-150x150.jpg" alt="Yin Huai" height="50" width="50"></a><a href="https://databricks.com/blog/author/cheng-liang" class="blog-post--header--meta--item-author-avatars--avatar"><img src="Deep%20Dive%20into%20Spark%20SQL%E2%80%99s%20Catalyst%20Optimizer_files/ChengL-150x150.jpg" alt="Cheng Liang" height="50" width="50"></a><a href="https://databricks.com/blog/author/rxin" class="blog-post--header--meta--item-author-avatars--avatar"><img src="Deep%20Dive%20into%20Spark%20SQL%E2%80%99s%20Catalyst%20Optimizer_files/reynoldx-128x128.jpg" alt="Reynold Xin" class="avatar avatar-100 wp-user-avatar wp-user-avatar-100 alignnone photo" height="100" width="100"></a><a href="https://databricks.com/blog/author/matei" class="blog-post--header--meta--item-author-avatars--avatar"><img src="Deep%20Dive%20into%20Spark%20SQL%E2%80%99s%20Catalyst%20Optimizer_files/MateiZ-128x128.jpg" alt="Matei Zaharia" class="avatar avatar-100 wp-user-avatar wp-user-avatar-100 alignnone photo" height="100" width="100"></a>          </span>
          <span class="blog-post--header--meta--item blog-post--header--meta--item-authors">by <a href="https://databricks.com/blog/author/michael" title="Posts by Michael Armbrust" class="author url fn" rel="author">Michael Armbrust</a>, <a href="https://databricks.com/blog/author/yin-huai" title="Posts by Yin Huai" class="author url fn" rel="author">Yin Huai</a>, <a href="https://databricks.com/blog/author/cheng-liang" title="Posts by Cheng Liang" class="author url fn" rel="author">Cheng Liang</a>, <a href="https://databricks.com/blog/author/rxin" title="Posts by Reynold Xin" class="author url fn" rel="author">Reynold Xin</a> and <a href="https://databricks.com/blog/author/matei" title="Posts by Matei Zaharia" class="author url fn" rel="author">Matei Zaharia</a></span>
                      <span class="blog-post--header--meta--item blog-post--header--meta--item-category"><span class="hidden-xs">Posted</span> in <a href="https://databricks.com/blog/category/engineering">Engineering Blog</a></span>
                    <span class="blog-post--header--meta--item blog-post--header--meta--item-date hidden-xs">
            <a href="https://databricks.com/blog/2015/04/13/deep-dive-into-spark-sqls-catalyst-optimizer.html"><time datetime="2015-04-13T07:30:44+00:00">April 13, 2015</time></a>
          </span>
                  </div>

          <div class="blog-post--header--share hidden-md hidden-lg">
          <ul class="navbar-share">
    <li>
      <a href="https://twitter.com/home?status=https://databricks.com/blog/2015/04/13/deep-dive-into-spark-sqls-catalyst-optimizer.html" class="twitter" target="_blank">
        <span class="db-icon-twitter"></span>
        <span class="sr-only">Share article on Twitter</span>
      </a>
    </li>
    <li>
      <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://databricks.com/blog/2015/04/13/deep-dive-into-spark-sqls-catalyst-optimizer.html&amp;title=Deep%20Dive%20into%20Spark%20SQL%E2%80%99s%20Catalyst%20Optimizer&amp;summary=&amp;source=" class="linkedin" target="_blank">
        <span class="db-icon-linkedin"></span>
        <span class="sr-only">Share article on LinkedIn</span>
      </a>
    </li>
    <li>
      <a href="https://www.facebook.com/sharer/sharer.php?u=https://databricks.com/blog/2015/04/13/deep-dive-into-spark-sqls-catalyst-optimizer.html" class="facebook" target="_blank">
        <span class="db-icon-facebook"></span>
        <span class="sr-only">Share article on Facebook</span>
      </a>
    </li>
  </ul>
        </div>
      </header>

      <article class="blog-post--section blog-post--article l-formatted">
      <p>Spark SQL is one of the newest and most technically involved components of Spark. It powers both SQL queries and the new <a href="https://databricks.com/blog/2015/02/17/introducing-dataframes-in-spark-for-large-scale-data-science.html">DataFrame API</a>. At the core of Spark SQL is the Catalyst optimizer, which leverages advanced programming language features (e.g. Scala’s <a href="http://docs.scala-lang.org/tutorials/tour/pattern-matching.html">pattern matching</a> and <a href="http://docs.scala-lang.org/overviews/quasiquotes/intro.html">quasiquotes</a>) in a novel way to build an extensible query optimizer.</p>
<p>We recently published a <a href="http://people.csail.mit.edu/matei/papers/2015/sigmod_spark_sql.pdf" target="_blank">paper</a> on Spark SQL that will appear in <a href="http://www.sigmod2015.org/">SIGMOD 2015</a>
 (co-authored with Davies Liu, Joseph K. Bradley, Xiangrui Meng, Tomer 
Kaftan, Michael J. Franklin, and Ali Ghodsi). In this blog post we are 
republishing a section in the paper that explains the internals of the 
Catalyst optimizer for broader consumption.</p>
<p>To implement Spark SQL, we designed a new extensible optimizer, 
Catalyst, based on functional programming constructs in Scala. 
Catalyst’s extensible design had two purposes. First, we wanted to make 
it easy to add new optimization techniques and features to Spark SQL, 
especially for the purpose of&nbsp;tackling various problems we were 
seeing with big data (e.g., semistructured data and advanced analytics).
 Second, we wanted to enable external developers to extend the optimizer
 — for example, by adding data source specific rules that can push 
filtering or aggregation into external storage systems, or support for 
new data types. Catalyst supports both rule-based and cost-based 
optimization.</p>
<p>At its core, Catalyst contains a general library for representing 
trees and applying rules to manipulate them. On top of this framework, 
we have built libraries specific to relational query processing (e.g., 
expressions, logical query plans), and several sets of rules that handle
 different phases of query execution: analysis, logical optimization, 
physical planning, and code generation to compile parts of queries to 
Java bytecode. For the latter, we use another Scala feature, <a href="http://docs.scala-lang.org/overviews/quasiquotes/intro.html">quasiquotes</a>,
 that makes it easy to generate code at runtime from composable 
expressions. Finally, Catalyst offers several public extension points, 
including external data sources and user-defined types.</p>
<h2>Trees</h2>
<p>The main data type in Catalyst is a tree composed of node objects. 
Each node has a node type and zero or more children. New node types are 
defined in Scala as subclasses of the TreeNode class. These objects are 
immutable and can be manipulated using functional transformations, as 
discussed in the next subsection.</p>
<p>As a simple example, suppose we have the following three node classes for a very simple expression language:</p>
<ul>
<li><code>Literal(value: Int)</code>: a constant value</li>
<li><code>Attribute(name: String):</code> an attribute from an input row, e.g.,“x”</li>
<li><code>Add(left: TreeNode, right: TreeNode):</code> sum of two expressions.</li>
</ul>
<p>These classes can be used to build up trees; for example, the tree for the expression&nbsp;<code>x+(1+2)</code>, would be represented in Scala code as follows:</p>
<pre style="" class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><span class="typ">Add</span><span class="pun">(</span><span class="typ">Attribute</span><span class="pun">(</span><span class="pln">x</span><span class="pun">),</span><span class="pln"> </span><span class="typ">Add</span><span class="pun">(</span><span class="typ">Literal</span><span class="pun">(</span><span class="lit">1</span><span class="pun">),</span><span class="pln"> </span><span class="typ">Literal</span><span class="pun">(</span><span class="lit">2</span><span class="pun">)))</span></li></ol></pre>
<p><a class="lightbox-trigger" href="https://databricks.com/wp-content/uploads/2015/04/Screen-Shot-2015-04-12-at-8.11.11-AM.png"><img class="aligncenter wp-image-3382 size-medium" src="Deep%20Dive%20into%20Spark%20SQL%E2%80%99s%20Catalyst%20Optimizer_files/Screen-Shot-2015-04-12-at-8_003.png" alt="Catalyst blog figure 1" height="174" width="300"></a></p>
<p>&nbsp;</p>
<h2>Rules</h2>
<p>Trees can be manipulated using rules, which are functions from a tree
 to another tree. While a rule can run arbitrary code on its input tree 
(given that this tree is just a Scala object), the most common approach 
is to use a set of pattern matching functions that find and replace 
subtrees with a specific structure.</p>
<p>Pattern matching is a feature of many functional languages that 
allows extracting values from potentially nested structures of algebraic
 data types. In Catalyst, trees offer a transform method that applies a 
pattern matching function recursively on all nodes of the tree, 
transforming the ones that match each pattern to a result. For example, 
we could implement a rule that folds Add operations between constants as
 follows:</p>
<pre style="" class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><span class="pln">tree</span><span class="pun">.</span><span class="pln">transform </span><span class="pun">{</span></li><li class="L1"><span class="pln">  </span><span class="kwd">case</span><span class="pln"> </span><span class="typ">Add</span><span class="pun">(</span><span class="typ">Literal</span><span class="pun">(</span><span class="pln">c1</span><span class="pun">),</span><span class="pln"> </span><span class="typ">Literal</span><span class="pun">(</span><span class="pln">c2</span><span class="pun">))</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> </span><span class="typ">Literal</span><span class="pun">(</span><span class="pln">c1</span><span class="pun">+</span><span class="pln">c2</span><span class="pun">)</span></li><li class="L2"><span class="pun">}</span></li></ol></pre>
<p>Applying this to the tree for <code>x+(1+2)</code> would yield the new tree <code>x+3</code>. The <code>case</code>
 keyword here is Scala’s standard pattern matching syntax, and can be 
used to match on the type of an object as well as give names to 
extracted values (<code>c1</code> and <code>c2</code> here).</p>
<p>The pattern matching expression that is passed to transform is a 
partial function, meaning that it only needs to match to a subset of all
 possible input trees. Catalyst will tests which parts of a tree a given
 rule applies to, automatically skipping over and descending into 
subtrees that do not match. This ability means that rules only need to 
reason about the trees where a given optimization applies and not those 
that do not match. Thus, rules do not need to be modified as new types 
of operators are added to the system.</p>
<p>Rules (and Scala pattern matching in general) can match multiple 
patterns in the same transform call, making it very concise to implement
 multiple transformations at once:</p>
<pre style="" class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><span class="pln">tree</span><span class="pun">.</span><span class="pln">transform </span><span class="pun">{</span></li><li class="L1"><span class="pln">  </span><span class="kwd">case</span><span class="pln"> </span><span class="typ">Add</span><span class="pun">(</span><span class="typ">Literal</span><span class="pun">(</span><span class="pln">c1</span><span class="pun">),</span><span class="pln"> </span><span class="typ">Literal</span><span class="pun">(</span><span class="pln">c2</span><span class="pun">))</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> </span><span class="typ">Literal</span><span class="pun">(</span><span class="pln">c1</span><span class="pun">+</span><span class="pln">c2</span><span class="pun">)</span></li><li class="L2"><span class="pln">  </span><span class="kwd">case</span><span class="pln"> </span><span class="typ">Add</span><span class="pun">(</span><span class="pln">left</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Literal</span><span class="pun">(</span><span class="lit">0</span><span class="pun">))</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> left</span></li><li class="L3"><span class="pln">  </span><span class="kwd">case</span><span class="pln"> </span><span class="typ">Add</span><span class="pun">(</span><span class="typ">Literal</span><span class="pun">(</span><span class="lit">0</span><span class="pun">),</span><span class="pln"> right</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> right</span></li><li class="L4"><span class="pun">}</span></li></ol></pre>
<p>In practice, rules may need to execute multiple times to fully 
transform a tree. Catalyst groups rules into batches, and executes each 
batch until it reaches a fixed point, that is, until the tree stops 
changing after applying its rules. Running rules to fixed point means 
that each rule can be simple and self-contained, and yet still 
eventually have larger global effects on a tree. In the example above, 
repeated application would constant-fold larger trees, such as <code>(x+0)+(3+3)</code>.
 As another example, a first batch might analyze an expression to assign
 types to all of the attributes, while a second batch might use these 
types to do constant folding. After each batch, developers can also run 
sanity checks on the new tree (e.g., to see that all attributes were 
assigned types), often also written via recursive matching.</p>
<p>Finally, rule conditions and their bodies can contain arbitrary Scala
 code. This gives Catalyst more power than domain specific languages for
 optimizers, while keeping it concise for simple rules.</p>
<p>In our experience, functional transformations on immutable trees make
 the whole optimizer very easy to reason about and debug. They also 
enable parallelization in the optimizer, although we do not yet exploit 
this.</p>
<h2>Using Catalyst in Spark SQL</h2>
<p><strong><br>
</strong>We use Catalyst’s general tree transformation framework in four
 phases, as shown below: (1) analyzing a logical plan to resolve 
references, (2) logical plan optimization, (3) physical planning, and 
(4) code generation to compile parts of the query to Java bytecode. In 
the physical planning phase, Catalyst may generate multiple plans and 
compare them based on cost. All other phases are purely rule-based. Each
 phase uses different types of tree nodes; Catalyst includes libraries 
of nodes for expressions, data types, and logical and physical 
operators. We now describe each of these phases.</p>
<p><a class="lightbox-trigger" href="https://databricks.com/wp-content/uploads/2015/04/Screen-Shot-2015-04-12-at-8.41.26-AM.png"><img class="aligncenter wp-image-3385" src="Deep%20Dive%20into%20Spark%20SQL%E2%80%99s%20Catalyst%20Optimizer_files/Screen-Shot-2015-04-12-at-8.png" alt="Catalyst blog figure 2" height="184" width="800"></a></p>
<h2>Analysis</h2>
<p>Spark SQL begins with a relation to be computed, either from an 
abstract syntax tree (AST) returned by a SQL parser, or from a DataFrame
 object constructed using the API. In both cases, the relation may 
contain unresolved attribute references or relations: for example, in 
the SQL query <code>SELECT col FROM sales</code>, the type of col, or 
even whether it is a valid column name, is not known until we look up 
the table sales. An attribute is called unresolved if we do not know its
 type or have not matched it to an input table (or an alias). Spark SQL 
uses Catalyst rules and a Catalog object that tracks the tables in all 
data sources to resolve these attributes. It starts by building an 
“unresolved logical plan” tree with unbound attributes and data types, 
then applies rules that do the following:</p>
<ul>
<li>Looking up relations by name from the catalog.</li>
<li>Mapping named attributes, such as col, to the input provided given operator’s children.</li>
<li>Determining which attributes refer to the same value to give them a 
unique ID (which later allows optimization of expressions such as <code>col = col</code>).</li>
<li>Propagating and coercing types through expressions: for example, we cannot know the return type of <code>1 + col</code> until we have resolved col and possibly casted its subexpressions to a compatible types.</li>
</ul>
<p>In total, the rules for the analyzer are about <a href="https://github.com/apache/spark/blob/fedbfc7074dd6d38dc5301d66d1ca097bc2a21e0/sql/catalyst/src/main/scala/org/apache/spark/sql/catalyst/analysis/Analyzer.scala">1000 lines of code</a>.</p>
<h2>Logical Optimizations</h2>
<p>The logical optimization phase applies standard rule-based 
optimizations to the logical plan. (Cost-based optimization is performed
 by generating multiple plans using rules, and then computing their 
costs.) These include constant folding, predicate pushdown, projection 
pruning, null propagation, Boolean expression simplification, and other 
rules. In general, we have found it extremely simple to add rules for a 
wide variety of situations. For example, when we added the 
fixed-precision DECIMAL type to Spark SQL, we wanted to optimize 
aggregations such as sums and averages on DECIMALs with small 
precisions; it took 12 lines of code to write a rule that finds such 
decimals in SUM and AVG expressions, and casts them to unscaled 64-bit 
LONGs, does the aggregation on that, then converts the result back. A 
simplified version of this rule that only optimizes SUM expressions is 
reproduced below:</p>
<pre style="" class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><span class="kwd">object</span><span class="pln"> </span><span class="typ">DecimalAggregates</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Rule</span><span class="pun">[</span><span class="typ">LogicalPlan</span><span class="pun">]</span><span class="pln"> </span><span class="pun">{</span></li><li class="L1"><span class="pln">  </span><span class="com">/** Maximum number of decimal digits in a Long */</span></li><li class="L2"><span class="pln">  val MAX_LONG_DIGITS </span><span class="pun">=</span><span class="pln"> </span><span class="lit">18</span></li><li class="L3"><span class="pln">  </span><span class="kwd">def</span><span class="pln"> apply</span><span class="pun">(</span><span class="pln">plan</span><span class="pun">:</span><span class="pln"> </span><span class="typ">LogicalPlan</span><span class="pun">):</span><span class="pln"> </span><span class="typ">LogicalPlan</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span></li><li class="L4"><span class="pln">    plan transformAllExpressions </span><span class="pun">{</span></li><li class="L5"><span class="pln">      </span><span class="kwd">case</span><span class="pln"> </span><span class="typ">Sum</span><span class="pun">(</span><span class="pln">e </span><span class="pun">@</span><span class="pln"> </span><span class="typ">DecimalType</span><span class="pun">.</span><span class="typ">Expression</span><span class="pun">(</span><span class="pln">prec</span><span class="pun">,</span><span class="pln"> scale</span><span class="pun">))</span></li><li class="L6"><span class="pln">          </span><span class="kwd">if</span><span class="pln"> prec </span><span class="pun">+</span><span class="pln"> </span><span class="lit">10</span><span class="pln"> </span><span class="pun">&lt;=</span><span class="pln"> MAX_LONG_DIGITS </span><span class="pun">=&gt;</span></li><li class="L7"><span class="pln">        </span><span class="typ">MakeDecimal</span><span class="pun">(</span><span class="typ">Sum</span><span class="pun">(</span><span class="typ">UnscaledValue</span><span class="pun">(</span><span class="pln">e</span><span class="pun">)),</span><span class="pln"> prec </span><span class="pun">+</span><span class="pln"> </span><span class="lit">10</span><span class="pun">,</span><span class="pln"> scale</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span></li><li class="L8"><span class="pun">}</span></li></ol></pre>
<p>As another example, a 12-line rule optimizes LIKE expressions with 
simple regular expressions into String.startsWith or String.contains 
calls. The freedom to use arbitrary Scala code in rules made these kinds
 of optimizations, which go beyond pattern-matching the structure of a 
subtree, easy to express.</p>
<p>In total, the logical optimization rules are <a href="https://github.com/apache/spark/blob/fedbfc7074dd6d38dc5301d66d1ca097bc2a21e0/sql/catalyst/src/main/scala/org/apache/spark/sql/catalyst/optimizer/Optimizer.scala">800 lines of code</a>.</p>
<h2>Physical Planning</h2>
<p>In the physical planning phase, Spark SQL takes a logical plan and 
generates one or more physical plans, using physical operators that 
match the Spark execution engine. It then selects a plan using a cost 
model. At the moment, cost-based optimization is only used to select 
join algorithms: for relations that are known to be small, Spark SQL 
uses a broadcast join, using a peer-to-peer broadcast facility available
 in Spark. The framework supports broader use of cost-based 
optimization, however, as costs can be estimated recursively for a whole
 tree using a rule. We thus intend to implement richer cost-based 
optimization in the future.</p>
<p>The physical planner also performs rule-based physical optimizations,
 such as pipelining projections or filters into one Spark map operation.
 In addition, it can push operations from the logical plan into data 
sources that support predicate or projection pushdown. We will describe 
the API for these data sources in a later section.</p>
<p>In total, the physical planning rules are about <a href="https://github.com/apache/spark/blob/fedbfc7074dd6d38dc5301d66d1ca097bc2a21e0/sql/core/src/main/scala/org/apache/spark/sql/execution/SparkStrategies.scala">500 lines of code</a>.</p>
<h2>Code Generation</h2>
<p>The final phase of query optimization involves generating Java 
bytecode to run on each machine. Because Spark SQL often operates on 
in-memory datasets, where processing is CPU-bound, we wanted to support 
code generation to speed up execution. Nonetheless, code generation 
engines are often complicated to build, amounting essentially to a 
compiler. Catalyst relies on a special feature of the Scala language, 
quasiquotes, to make code generation simpler. Quasiquotes allow the 
programmatic construction of abstract syntax trees (ASTs) in the Scala 
language, which can then be fed to the Scala compiler at runtime to 
generate bytecode. We use Catalyst to transform a tree representing an 
expression in SQL to an AST for Scala code to evaluate that expression, 
and then compile and run the generated code.</p>
<p>As a simple example, consider the Add, Attribute and Literal tree 
nodes introduced in Section 4.2, which allowed us to write expressions 
such as <code>(x+y)+1</code>. Without code generation, such expressions 
would have to be interpreted for each row of data, by walking down a 
tree of Add, Attribute and Literal nodes. This introduces large amounts 
of branches and virtual function calls that slow down execution. With 
code generation, we can write a function to translate a specific 
expression tree to a Scala AST as follows:</p>
<pre style="" class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><span class="kwd">def</span><span class="pln"> compile</span><span class="pun">(</span><span class="pln">node</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Node</span><span class="pun">):</span><span class="pln"> AST </span><span class="pun">=</span><span class="pln"> node match </span><span class="pun">{</span></li><li class="L1"><span class="pln">  </span><span class="kwd">case</span><span class="pln"> </span><span class="typ">Literal</span><span class="pun">(</span><span class="pln">value</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> q</span><span class="str">"$value"</span></li><li class="L2"><span class="pln">  </span><span class="kwd">case</span><span class="pln"> </span><span class="typ">Attribute</span><span class="pun">(</span><span class="pln">name</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> q</span><span class="str">"row.get($name)"</span></li><li class="L3"><span class="pln">  </span><span class="kwd">case</span><span class="pln"> </span><span class="typ">Add</span><span class="pun">(</span><span class="pln">left</span><span class="pun">,</span><span class="pln"> right</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> q</span><span class="str">"${compile(left)} + ${compile(right)}"</span></li><li class="L4"><span class="pun">}</span></li></ol></pre>
<p>The strings beginning with <code>q</code> are quasiquotes, meaning 
that although they look like strings, they are parsed by the Scala 
compiler at compile time and represent ASTs for the code within. 
Quasiquotes can have variables or other ASTs spliced into them, 
indicated using <code>$</code> notation. For example, <code>Literal(1)</code> would become the Scala AST for 1, while <code>Attribute("x")</code> becomes <code>row.get("x")</code>. In the end, a tree like <code>Add(Literal(1), Attribute("x"))</code> becomes an AST for a Scala expression like <code>1+row.get("x")</code>.</p>
<p>Quasiquotes are type-checked at compile time to ensure that only 
appropriate ASTs or literals are substituted in, making them 
significantly more useable than string concatenation, and they result 
directly in a Scala AST instead of running the Scala parser at runtime. 
Moreover, they are highly composable, as the code generation rule for 
each node does not need to know how the trees returned by its children 
are constructed. Finally, the resulting code is further optimized by the
 Scala compiler in case there are expression-level optimizations that 
Catalyst missed. The following figure shows that quasiquotes let us 
generate code with performance similar to hand-tuned programs.<br>
<img class="aligncenter" src="Deep%20Dive%20into%20Spark%20SQL%E2%80%99s%20Catalyst%20Optimizer_files/Screen-Shot-2015-04-12-at-8_002.png" alt="" width="400"></p>
<p>We have found quasiquotes very straightforward to use for code 
generation, and we observed that even new contributors to Spark SQL 
could quickly add rules for new types of expressions. Quasiquotes also 
work well with our goal of running on native Java objects: when 
accessing fields from these objects, we can code-generate a direct 
access to the required field, instead of having to copy the object into a
 Spark SQL Row and use the Row’s accessor methods. Finally, it was 
straightforward to combine code-generated evalua- tion with interpreted 
evaluation for expressions we do not yet generate code for, since the 
Scala code we compile can directly call into our expression interpreter.</p>
<p>In total, Catalyst’s code generator is about <a href="https://github.com/apache/spark/blob/fedbfc7074dd6d38dc5301d66d1ca097bc2a21e0/sql/catalyst/src/main/scala/org/apache/spark/sql/catalyst/expressions/codegen/CodeGenerator.scala">700 lines of code</a>.</p>
<p>This blog post covered the internals of Spark SQL’s Catalyst 
optimizer. It’s novel, simple design has enabled the Spark community to 
rapidly prototype, implement, and extend the engine. You can read 
through rest of the <a href="http://people.csail.mit.edu/matei/papers/2015/sigmod_spark_sql.pdf" target="_blank">paper here</a>. If you are attending SIGMOD this year, please drop by our session!<strong><strong><br>
</strong></strong></p>
<p>You can also find more information about Spark SQL from the following:</p>
<ul>
<li><a href="http://spark.apache.org/docs/latest/sql-programming-guide.html">Spark SQL and DataFrame Programming Guide</a> from Apache Spark</li>
<li><a href="http://www.slideshare.net/databricks/yin-huai-20150325meetupwithdemos">Data Source API in Spark</a> presentation by Yin Huai</li>
<li><a href="http://www.slideshare.net/databricks/introducing-dataframes-in-spark-for-large-scale-data-science">Introducing DataFrames in Spark for Large Scale Data Science</a> by Reynold Xin</li>
<li><a href="http://www.slideshare.net/databricks/spark-sqlsse2015public">Beyond SQL: Speeding up Spark with DataFrames</a> by Michael Armbrust</li>
</ul>
<p class="blog-post--bug"><img src="Deep%20Dive%20into%20Spark%20SQL%E2%80%99s%20Catalyst%20Optimizer_files/Databricks-logo-bug.png" alt="Databricks Blog" height="16" width="15"></p>    <div class="blog-post--cta blog-post--cta-free-trial">
      <span class="blog-post--cta-free-trial--label">Try Databricks for free.</span>
      <a href="https://databricks.com/try-databricks" class="btn h-btn-color-blue h-btn-size-sm blog-post--cta-free-trial--btn" data-track-button-click-event="Blog Post Signup CTA">Get started Today</a>    </div>
        </article>

            <div class="blog-post--section blog-post--related">
          <h3 class="blog-post--section--title">Read More</h3>
          <div class="row"><div class=" col-xs-12 col-md-4"><div class="col-inner">              <a class="blog-post--related--related-post" href="https://databricks.com/blog/2016/03/22/apache-spark-trending-in-the-stack-overflow-survey.html" data-track-event-category="Related Blog Post" data-track-event-action="click" data-track-event-label="Apache Spark Trending in the Stack Overflow Survey">
                <h4 class="blog-post--related--related-post--title">
                  Apache Spark Trending in the Stack Overflow Survey                </h4>
                <p class="blog-post--related--related-post--excerpt">
                  Last week, Stack Overflow released the result of their
 2016 developer survey. This is one of the most significant surveys in 
the field with responses...                </p>
              </a>

              </div></div><div class=" col-xs-12 col-md-4"><div class="col-inner">              <a class="blog-post--related--related-post" href="https://databricks.com/blog/2016/03/03/introducing-graphframes.html" data-track-event-category="Related Blog Post" data-track-event-action="click" data-track-event-label="Introducing GraphFrames">
                <h4 class="blog-post--related--related-post--title">
                  Introducing GraphFrames                </h4>
                <p class="blog-post--related--related-post--excerpt">
                  We would like to thank Ankur Dave from&nbsp;UC 
Berkeley AMPLab for his contribution to this blog post. Databricks is 
excited to announce the release of...                </p>
              </a>

              </div></div><div class=" col-xs-12 col-md-4"><div class="col-inner">              <a class="blog-post--related--related-post" href="https://databricks.com/blog/2016/02/09/reshaping-data-with-pivot-in-apache-spark.html" data-track-event-category="Related Blog Post" data-track-event-action="click" data-track-event-label="Reshaping Data with Pivot in Apache Spark">
                <h4 class="blog-post--related--related-post--title">
                  Reshaping Data with Pivot in Apache Spark                </h4>
                <p class="blog-post--related--related-post--excerpt">
                  Spark Summit East is just around the corner! If you 
haven’t registered yet, you can get tickets&nbsp;here and here’s a promo
 code for 20% off:...                </p>
              </a>

              </div></div></div>        </div>
      </div>
          <div class="blog-content--footer">
                          <a href="https://databricks.com/blog/category/engineering" class="btn h-btn-color-gray">See all Engineering Blog posts</a>                      </div>
                </div>
    </div>

          <div class="col-md-3 hidden-xs hidden-sm">
        <div class="blog-sidebar blog-sidebar--widgets">
      <div class="blog-sidebar--section blog-sidebar--widgets--section blog-sidebar--widgets--section-share">
      <h4 class="blog-sidebar--section--title">Share Post</h4>

        <ul class="navbar-share">
    <li>
      <a href="https://twitter.com/home?status=https://databricks.com/blog/2015/04/13/deep-dive-into-spark-sqls-catalyst-optimizer.html" class="twitter" target="_blank">
        <span class="db-icon-twitter"></span>
        <span class="sr-only">Share article on Twitter</span>
      </a>
    </li>
    <li>
      <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://databricks.com/blog/2015/04/13/deep-dive-into-spark-sqls-catalyst-optimizer.html&amp;title=Deep%20Dive%20into%20Spark%20SQL%E2%80%99s%20Catalyst%20Optimizer&amp;summary=&amp;source=" class="linkedin" target="_blank">
        <span class="db-icon-linkedin"></span>
        <span class="sr-only">Share article on LinkedIn</span>
      </a>
    </li>
    <li>
      <a href="https://www.facebook.com/sharer/sharer.php?u=https://databricks.com/blog/2015/04/13/deep-dive-into-spark-sqls-catalyst-optimizer.html" class="facebook" target="_blank">
        <span class="db-icon-facebook"></span>
        <span class="sr-only">Share article on Facebook</span>
      </a>
    </li>
  </ul>
      </div>

        <div id="text-8" class="blog-sidebar--section blog-sidebar--widgets--section">			<div class="textwidget"><a href="http://go.databricks.com/large-scale-machine-learning-deployments-spark-databricks" data-track-event-category="Banners" data-track-event-action="Clicked" data-track-event-label="Blog Sidebar Banner" target="_blank"><img src="Deep%20Dive%20into%20Spark%20SQL%E2%80%99s%20Catalyst%20Optimizer_files/Book3-Blog-ad.png" alt="Get the Lessons for large-scale machine learning deployments on Databricks eBook" height="263" width="263"></a></div>
		</div><div id="text-9" class="blog-sidebar--section blog-sidebar--widgets--section"><h4 class="blog-sidebar--section--title">Simplify Machine Learning with Apache&nbsp;Spark</h4>			<div class="textwidget"><ul class="list-unstyled">
<li><a href="http://go.databricks.com/industry-perspectives-deliver-the-power-of-machine-learning?utm_source=Databricks%20Blog&amp;utm_medium=link&amp;utm_campaign=Machine%20Learning&amp;utm_content=dinsmore" target="_blank">Read the White Paper</a></li>
<li><a href="http://go.databricks.com/machine-learning-starterkit?utm_source=Databricks%20Blog&amp;utm_medium=link&amp;utm_campaign=Machine%20Learning&amp;utm_content=ml_starterkit" target="_blank">Download our Machine Learning Starter Kit</a></li>
</ul></div>
		</div><div id="text-10" class="blog-sidebar--section blog-sidebar--widgets--section"><h4 class="blog-sidebar--section--title">Upcoming Webinars</h4>			<div class="textwidget"><ul class="list-unstyled">
<li><a href="http://go.databricks.com/webinar-how-omega-point-builds-more-profitable-investment-portfolios-with-databricks" target="_blank">Aug 18: How Omega Point Helps Investors Optimize their Portfolios with Apache® Spark™ on Databricks</a></li>
</ul></div>
		</div></div>
      </div>
      </div>
</div>
</div></div><!-- .body-content -->

<div class="body-footer container">
  <div class="footer-inner">
    <div class="row">
      <div class="col-sm-3 col_widget_nav_menu"><div class="col-inner"><div id="nav_menu-2" class="widget widget_nav_menu"><div class="menu-site-menu-container"><ul id="menu-site-menu-1" class="menu"><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-7076"><a href="https://databricks.com/product">Product</a>
<ul class="sub-menu">
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-7077"><a href="https://databricks.com/product/databricks">Databricks</a></li>
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-8128"><a href="https://databricks.com/product/getting-started-with-apache-spark-on-databricks">How to Get Started</a></li>
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-7079"><a href="https://databricks.com/product/pricing">Pricing</a></li>
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-7080"><a href="https://databricks.com/product/security">Security</a></li>
	<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-8178"><a href="https://docs.cloud.databricks.com/docs/latest/api/index.html">API Documentation</a></li>
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-7078"><a href="https://databricks.com/product/faq">FAQ</a></li>
	<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-4032"><a href="https://forums.databricks.com/">Forums</a></li>
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-7081"><a href="https://databricks.com/academic">Academic Program</a></li>
</ul>
</li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-7082"><a href="https://databricks.com/spark">Apache Spark</a>
<ul class="sub-menu">
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-7083"><a href="https://databricks.com/spark/about">About Apache Spark</a></li>
	<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-4688"><a href="http://sparkhub.databricks.com/">SparkHub (Community)</a></li>
	<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-7767"><a href="https://sparkhub.databricks.com/resources/">Developer Resources</a></li>
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-7084"><a href="https://databricks.com/spark/certification">Certification</a></li>
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-7086"><a href="https://databricks.com/spark/training">Training</a></li>
</ul>
</li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-7087"><a href="https://databricks.com/solutions">Solutions</a>
<ul class="sub-menu">
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-7089"><a href="https://databricks.com/solutions/by-role">By Role</a></li>
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-7088"><a href="https://databricks.com/solutions/by-industry">By Industry</a></li>
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-7090"><a href="https://databricks.com/solutions/by-use-case">By Use Case</a></li>
</ul>
</li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-7091"><a href="https://databricks.com/customers">Customers</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-7092"><a href="https://databricks.com/company">Company</a>
<ul class="sub-menu">
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-7093"><a href="https://databricks.com/company/about-us">About Us</a></li>
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-7096"><a href="https://databricks.com/company/leadership-team">Leadership</a></li>
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-7097"><a href="https://databricks.com/company/team">Team</a></li>
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-7099"><a href="https://databricks.com/company/partners">Partners</a></li>
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-7098"><a href="https://databricks.com/company/newsroom">Newsroom</a></li>
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-7094"><a href="https://databricks.com/company/careers">Careers</a></li>
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-7095"><a href="https://databricks.com/company/contact">Contact</a></li>
</ul>
</li>
<li class="menu-item menu-item-type-post_type menu-item-object-page current_page_parent menu-item-has-children menu-item-7100"><a href="https://databricks.com/blog">Blog</a>
<ul class="sub-menu">
	<li class="menu-item menu-item-type-post_type menu-item-object-page current_page_parent menu-item-7101"><a href="https://databricks.com/blog">See All</a></li>
	<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6963"><a href="https://databricks.com/blog/category/company">Company Blog</a></li>
	<li class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-6964"><a href="https://databricks.com/blog/category/engineering">Engineering Blog</a></li>
</ul>
</li>
<li class="resource menu-item menu-item-type-resource menu-item-object-cpt_archive menu-item-8835"><a href="https://databricks.com/resources">Resources</a></li>
</ul></div></div></div></div><div class="col-sm-3 col_widget_text"><div class="col-inner"><div id="text-3" class="widget widget_text">			<div class="textwidget"><p>Databricks Inc.<br>
160 Spear Street, 13th Floor<br>
San Francisco, CA 94105</p>
<p><a href="mailto:info@databricks.com">info@databricks.com</a><br>
1-866-330-0121</p>
</div>
		</div></div></div>    </div>
    <div class="footer-copyright">
      <div class="row row-rtl">
        <div class="col-sm-3">
          <div class="col-inner">
            <ul class="company-social-links navbar-share">
              <li>
                <a href="https://twitter.com/databricks" target="_blank">
                  <span class="db-icon-twitter"></span>
                  <span class="sr-only">Databricks Twitter profile</span>
                </a>
              </li>
              <li>
                <a href="https://www.linkedin.com/company/databricks" target="_blank">
                  <span class="db-icon-linkedin"></span>
                  <span class="sr-only">Databricks LinkedIn profile</span>
                </a>
              </li>
              <li>
                <a href="https://www.facebook.com/pages/Databricks/560203607379694" target="_blank">
                  <span class="db-icon-facebook"></span>
                  <span class="sr-only">Databricks Facebook profile</span>
                </a>
              </li>

              <li>
                <a href="https://databricks.com/feed" target="_blank">
                  <span class="db-icon-rss"></span>
                  <span class="sr-only">Databricks Blog RSS feed</span>
                </a>
              </li>
            </ul>
          </div>
        </div>

        <div class="col-sm-9">
          <div class="col-inner">
            <p id="copyright" class="copyright-text">© Databricks 2016. All rights reserved. Apache, Apache Spark, Spark and the Spark logo are trademarks of the <a href="http://www.apache.org/">Apache Software Foundation</a>.<br><a href="https://databricks.com/privacy-policy">Privacy Policy</a> | <a href="https://databricks.com/terms-of-use">Terms of Use</a></p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript" src="Deep%20Dive%20into%20Spark%20SQL%E2%80%99s%20Catalyst%20Optimizer_files/jquery.js"></script>
<script type="text/javascript" src="Deep%20Dive%20into%20Spark%20SQL%E2%80%99s%20Catalyst%20Optimizer_files/vendor.js"></script>
<script type="text/javascript" src="Deep%20Dive%20into%20Spark%20SQL%E2%80%99s%20Catalyst%20Optimizer_files/main.js"></script>

<script type="text/javascript" src="Deep%20Dive%20into%20Spark%20SQL%E2%80%99s%20Catalyst%20Optimizer_files/wp-embed.js"></script>
<script type="text/javascript" src="Deep%20Dive%20into%20Spark%20SQL%E2%80%99s%20Catalyst%20Optimizer_files/external-tracking.js"></script>
<div id="su-footer-links" style="text-align: center;"></div>
<!-- Google Tag Manager -->
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-TWTKQQ"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-TWTKQQ');</script>
<!-- End Google Tag Manager -->

<script type="text/javascript">window.NREUM||(NREUM={});NREUM.info={"beacon":"bam.nr-data.net","licenseKey":"cc545fdb66","applicationID":"6839999","transactionName":"NgdbNxRUDBFYVxBYWA9NeAASXA0MFl0KVVIZ","queueTime":0,"applicationTime":567,"atts":"GkBYQVxOHx8=","errorBeacon":"bam.nr-data.net","agent":""}</script>

<div id="email-box-106" class="email-tab ready">
      <div class="email-tab-header"><button class="email-tab-toggle js-email-tab-toggle">Stay up to date on Apache Spark.</button><button class="email-tab-close js-email-tab-close">
          <span class="sr-only">Close</span>
          <span class="email-tab-close-label">×</span>
        </button></div>
      <div style="height: 159px;" class="email-tab-body js-email-tab-body">
        <p>Get the latest Apache Spark news delivered right to your inbox.</p>
        <div class="email-tab-form js-email-tab-form"><form novalidate="" accept-charset="UTF-8" action="https://forms.hubspot.com/uploads/form/v2/438089/231f17cf-5711-4165-9046-952cc5e0d138" enctype="multipart/form-data" id="hsForm_231f17cf-5711-4165-9046-952cc5e0d138" method="POST" class="hs-form stacked" data-form-id="231f17cf-5711-4165-9046-952cc5e0d138" data-portal-id="438089" data-reactid=".hbspt-forms-0"><fieldset class="form-columns-1" data-reactid=".hbspt-forms-0.0:$0"><div class="hs_email field hs-form-field" data-reactid=".hbspt-forms-0.0:$0.1:$email"><label class="" placeholder="Enter your " for="email-231f17cf-5711-4165-9046-952cc5e0d138" data-reactid=".hbspt-forms-0.0:$0.1:$email.0"><span data-reactid=".hbspt-forms-0.0:$0.1:$email.0.0"></span><span class="hs-form-required" data-reactid=".hbspt-forms-0.0:$0.1:$email.0.1">*</span></label><legend class="hs-field-desc" style="display:none;" data-reactid=".hbspt-forms-0.0:$0.1:$email.1"></legend><div class="input" data-reactid=".hbspt-forms-0.0:$0.1:$email.$email"><input id="email-231f17cf-5711-4165-9046-952cc5e0d138" class="hs-input" name="email" required="" placeholder="email" value="omidm@stanford.edu" data-reactid=".hbspt-forms-0.0:$0.1:$email.$email.0" type="email"></div></div></fieldset><fieldset class="form-columns-3" data-reactid=".hbspt-forms-0.0:$1"><div class="hs_company_demandbase field hs-form-field" style="display:none;" data-reactid=".hbspt-forms-0.0:$1.1:$company_demandbase"><label class="" placeholder="Enter your Company - Demandbase" for="company_demandbase-231f17cf-5711-4165-9046-952cc5e0d138" data-reactid=".hbspt-forms-0.0:$1.1:$company_demandbase.0"><span data-reactid=".hbspt-forms-0.0:$1.1:$company_demandbase.0.0">Company - Demandbase</span></label><legend class="hs-field-desc" style="display:none;" data-reactid=".hbspt-forms-0.0:$1.1:$company_demandbase.1"></legend><div class="input" data-reactid=".hbspt-forms-0.0:$1.1:$company_demandbase.$company_demandbase"><input name="company_demandbase" class="hs-input" value="" data-reactid=".hbspt-forms-0.0:$1.1:$company_demandbase.$company_demandbase.0" type="hidden"></div></div><div class="hs_data_source field hs-form-field" style="display:none;" data-reactid=".hbspt-forms-0.0:$1.1:$data_source"><label class="" placeholder="Enter your Data Source" for="data_source-231f17cf-5711-4165-9046-952cc5e0d138" data-reactid=".hbspt-forms-0.0:$1.1:$data_source.0"><span data-reactid=".hbspt-forms-0.0:$1.1:$data_source.0.0">Data Source</span></label><legend class="hs-field-desc" style="display:none;" data-reactid=".hbspt-forms-0.0:$1.1:$data_source.1"></legend><div class="input" data-reactid=".hbspt-forms-0.0:$1.1:$data_source.$data_source"><input name="data_source" class="hs-input" value="" data-reactid=".hbspt-forms-0.0:$1.1:$data_source.$data_source.0" type="hidden"></div></div><div class="hs_demandbase_sid field hs-form-field" style="display:none;" data-reactid=".hbspt-forms-0.0:$1.1:$demandbase_sid"><label class="" placeholder="Enter your Demandbase SID" for="demandbase_sid-231f17cf-5711-4165-9046-952cc5e0d138" data-reactid=".hbspt-forms-0.0:$1.1:$demandbase_sid.0"><span data-reactid=".hbspt-forms-0.0:$1.1:$demandbase_sid.0.0">Demandbase SID</span></label><legend class="hs-field-desc" style="display:none;" data-reactid=".hbspt-forms-0.0:$1.1:$demandbase_sid.1"></legend><div class="input" data-reactid=".hbspt-forms-0.0:$1.1:$demandbase_sid.$demandbase_sid"><input name="demandbase_sid" class="hs-input" value="" data-reactid=".hbspt-forms-0.0:$1.1:$demandbase_sid.$demandbase_sid.0" type="hidden"></div></div></fieldset><fieldset class="form-columns-3" data-reactid=".hbspt-forms-0.0:$2"><div class="hs_employee_range field hs-form-field" style="display:none;" data-reactid=".hbspt-forms-0.0:$2.1:$employee_range"><label class="" placeholder="Enter your Employee Range" for="employee_range-231f17cf-5711-4165-9046-952cc5e0d138" data-reactid=".hbspt-forms-0.0:$2.1:$employee_range.0"><span data-reactid=".hbspt-forms-0.0:$2.1:$employee_range.0.0">Employee Range</span></label><legend class="hs-field-desc" style="display:none;" data-reactid=".hbspt-forms-0.0:$2.1:$employee_range.1"></legend><div class="input" data-reactid=".hbspt-forms-0.0:$2.1:$employee_range.$employee_range"><input name="employee_range" class="hs-input" value="" data-reactid=".hbspt-forms-0.0:$2.1:$employee_range.$employee_range.0" type="hidden"></div></div><div class="hs_forbes_2000 field hs-form-field" style="display:none;" data-reactid=".hbspt-forms-0.0:$2.1:$forbes_2000"><label class="" placeholder="Enter your Forbes 2000" for="forbes_2000-231f17cf-5711-4165-9046-952cc5e0d138" data-reactid=".hbspt-forms-0.0:$2.1:$forbes_2000.0"><span data-reactid=".hbspt-forms-0.0:$2.1:$forbes_2000.0.0">Forbes 2000</span></label><legend class="hs-field-desc" style="display:none;" data-reactid=".hbspt-forms-0.0:$2.1:$forbes_2000.1"></legend><div class="input" data-reactid=".hbspt-forms-0.0:$2.1:$forbes_2000.$forbes_2000"><input name="forbes_2000" class="hs-input" value="false" data-reactid=".hbspt-forms-0.0:$2.1:$forbes_2000.$forbes_2000.0" type="hidden"></div></div><div class="hs_foreignstate field hs-form-field" style="display:none;" data-reactid=".hbspt-forms-0.0:$2.1:$foreignstate"><label class="" placeholder="Enter your FOREIGNSTATE" for="foreignstate-231f17cf-5711-4165-9046-952cc5e0d138" data-reactid=".hbspt-forms-0.0:$2.1:$foreignstate.0"><span data-reactid=".hbspt-forms-0.0:$2.1:$foreignstate.0.0">FOREIGNSTATE</span></label><legend class="hs-field-desc" style="display:none;" data-reactid=".hbspt-forms-0.0:$2.1:$foreignstate.1"></legend><div class="input" data-reactid=".hbspt-forms-0.0:$2.1:$foreignstate.$foreignstate"><input name="foreignstate" class="hs-input" value="" data-reactid=".hbspt-forms-0.0:$2.1:$foreignstate.$foreignstate.0" type="hidden"></div></div></fieldset><fieldset class="form-columns-3" data-reactid=".hbspt-forms-0.0:$3"><div class="hs_fortune_1000 field hs-form-field" style="display:none;" data-reactid=".hbspt-forms-0.0:$3.1:$fortune_1000"><label class="" placeholder="Enter your Fortune 1000" for="fortune_1000-231f17cf-5711-4165-9046-952cc5e0d138" data-reactid=".hbspt-forms-0.0:$3.1:$fortune_1000.0"><span data-reactid=".hbspt-forms-0.0:$3.1:$fortune_1000.0.0">Fortune 1000</span></label><legend class="hs-field-desc" style="display:none;" data-reactid=".hbspt-forms-0.0:$3.1:$fortune_1000.1"></legend><div class="input" data-reactid=".hbspt-forms-0.0:$3.1:$fortune_1000.$fortune_1000"><input name="fortune_1000" class="hs-input" value="" data-reactid=".hbspt-forms-0.0:$3.1:$fortune_1000.$fortune_1000.0" type="hidden"></div></div><div class="hs_main_phone_demandbase field hs-form-field" style="display:none;" data-reactid=".hbspt-forms-0.0:$3.1:$main_phone_demandbase"><label class="" placeholder="Enter your Phone - Demandbase" for="main_phone_demandbase-231f17cf-5711-4165-9046-952cc5e0d138" data-reactid=".hbspt-forms-0.0:$3.1:$main_phone_demandbase.0"><span data-reactid=".hbspt-forms-0.0:$3.1:$main_phone_demandbase.0.0">Phone - Demandbase</span></label><legend class="hs-field-desc" style="display:none;" data-reactid=".hbspt-forms-0.0:$3.1:$main_phone_demandbase.1"></legend><div class="input" data-reactid=".hbspt-forms-0.0:$3.1:$main_phone_demandbase.$main_phone_demandbase"><input name="main_phone_demandbase" class="hs-input" value="" data-reactid=".hbspt-forms-0.0:$3.1:$main_phone_demandbase.$main_phone_demandbase.0" type="hidden"></div></div><div class="hs_primary_sic field hs-form-field" style="display:none;" data-reactid=".hbspt-forms-0.0:$3.1:$primary_sic"><label class="" placeholder="Enter your Primary SIC" for="primary_sic-231f17cf-5711-4165-9046-952cc5e0d138" data-reactid=".hbspt-forms-0.0:$3.1:$primary_sic.0"><span data-reactid=".hbspt-forms-0.0:$3.1:$primary_sic.0.0">Primary SIC</span></label><legend class="hs-field-desc" style="display:none;" data-reactid=".hbspt-forms-0.0:$3.1:$primary_sic.1"></legend><div class="input" data-reactid=".hbspt-forms-0.0:$3.1:$primary_sic.$primary_sic"><input name="primary_sic" class="hs-input" value="" data-reactid=".hbspt-forms-0.0:$3.1:$primary_sic.$primary_sic.0" type="hidden"></div></div></fieldset><fieldset class="form-columns-3" data-reactid=".hbspt-forms-0.0:$4"><div class="hs_revenue_range field hs-form-field" style="display:none;" data-reactid=".hbspt-forms-0.0:$4.1:$revenue_range"><label class="" placeholder="Enter your Revenue Range" for="revenue_range-231f17cf-5711-4165-9046-952cc5e0d138" data-reactid=".hbspt-forms-0.0:$4.1:$revenue_range.0"><span data-reactid=".hbspt-forms-0.0:$4.1:$revenue_range.0.0">Revenue Range</span></label><legend class="hs-field-desc" style="display:none;" data-reactid=".hbspt-forms-0.0:$4.1:$revenue_range.1"></legend><div class="input" data-reactid=".hbspt-forms-0.0:$4.1:$revenue_range.$revenue_range"><input name="revenue_range" class="hs-input" value="" data-reactid=".hbspt-forms-0.0:$4.1:$revenue_range.$revenue_range.0" type="hidden"></div></div><div class="hs_stock_ticker field hs-form-field" style="display:none;" data-reactid=".hbspt-forms-0.0:$4.1:$stock_ticker"><label class="" placeholder="Enter your Stock Ticker" for="stock_ticker-231f17cf-5711-4165-9046-952cc5e0d138" data-reactid=".hbspt-forms-0.0:$4.1:$stock_ticker.0"><span data-reactid=".hbspt-forms-0.0:$4.1:$stock_ticker.0.0">Stock Ticker</span></label><legend class="hs-field-desc" style="display:none;" data-reactid=".hbspt-forms-0.0:$4.1:$stock_ticker.1"></legend><div class="input" data-reactid=".hbspt-forms-0.0:$4.1:$stock_ticker.$stock_ticker"><input name="stock_ticker" class="hs-input" value="" data-reactid=".hbspt-forms-0.0:$4.1:$stock_ticker.$stock_ticker.0" type="hidden"></div></div><div class="hs_sub_industry field hs-form-field" style="display:none;" data-reactid=".hbspt-forms-0.0:$4.1:$sub_industry"><label class="" placeholder="Enter your Sub Industry" for="sub_industry-231f17cf-5711-4165-9046-952cc5e0d138" data-reactid=".hbspt-forms-0.0:$4.1:$sub_industry.0"><span data-reactid=".hbspt-forms-0.0:$4.1:$sub_industry.0.0">Sub Industry</span></label><legend class="hs-field-desc" style="display:none;" data-reactid=".hbspt-forms-0.0:$4.1:$sub_industry.1"></legend><div class="input" data-reactid=".hbspt-forms-0.0:$4.1:$sub_industry.$sub_industry"><input name="sub_industry" class="hs-input" value="" data-reactid=".hbspt-forms-0.0:$4.1:$sub_industry.$sub_industry.0" type="hidden"></div></div></fieldset><fieldset class="form-columns-3" data-reactid=".hbspt-forms-0.0:$5"><div class="hs_watch_list_account_owner field hs-form-field" style="display:none;" data-reactid=".hbspt-forms-0.0:$5.1:$watch_list_account_owner"><label class="" placeholder="Enter your Watch List Account Owner" for="watch_list_account_owner-231f17cf-5711-4165-9046-952cc5e0d138" data-reactid=".hbspt-forms-0.0:$5.1:$watch_list_account_owner.0"><span data-reactid=".hbspt-forms-0.0:$5.1:$watch_list_account_owner.0.0">Watch List Account Owner</span></label><legend class="hs-field-desc" style="display:none;" data-reactid=".hbspt-forms-0.0:$5.1:$watch_list_account_owner.1"></legend><div class="input" data-reactid=".hbspt-forms-0.0:$5.1:$watch_list_account_owner.$watch_list_account_owner"><input name="watch_list_account_owner" class="hs-input" value="" data-reactid=".hbspt-forms-0.0:$5.1:$watch_list_account_owner.$watch_list_account_owner.0" type="hidden"></div></div><div class="hs_watch_list_account_status field hs-form-field" style="display:none;" data-reactid=".hbspt-forms-0.0:$5.1:$watch_list_account_status"><label class="" placeholder="Enter your Watch List Account Status" for="watch_list_account_status-231f17cf-5711-4165-9046-952cc5e0d138" data-reactid=".hbspt-forms-0.0:$5.1:$watch_list_account_status.0"><span data-reactid=".hbspt-forms-0.0:$5.1:$watch_list_account_status.0.0">Watch List Account Status</span></label><legend class="hs-field-desc" style="display:none;" data-reactid=".hbspt-forms-0.0:$5.1:$watch_list_account_status.1"></legend><div class="input" data-reactid=".hbspt-forms-0.0:$5.1:$watch_list_account_status.$watch_list_account_status"><input name="watch_list_account_status" class="hs-input" value="" data-reactid=".hbspt-forms-0.0:$5.1:$watch_list_account_status.$watch_list_account_status.0" type="hidden"></div></div><div class="hs_watch_list_account_type field hs-form-field" style="display:none;" data-reactid=".hbspt-forms-0.0:$5.1:$watch_list_account_type"><label class="" placeholder="Enter your Watch List Account Type" for="watch_list_account_type-231f17cf-5711-4165-9046-952cc5e0d138" data-reactid=".hbspt-forms-0.0:$5.1:$watch_list_account_type.0"><span data-reactid=".hbspt-forms-0.0:$5.1:$watch_list_account_type.0.0">Watch List Account Type</span></label><legend class="hs-field-desc" style="display:none;" data-reactid=".hbspt-forms-0.0:$5.1:$watch_list_account_type.1"></legend><div class="input" data-reactid=".hbspt-forms-0.0:$5.1:$watch_list_account_type.$watch_list_account_type"><input name="watch_list_account_type" class="hs-input" value="" data-reactid=".hbspt-forms-0.0:$5.1:$watch_list_account_type.$watch_list_account_type.0" type="hidden"></div></div></fieldset><fieldset class="form-columns-1" data-reactid=".hbspt-forms-0.0:$6"><div class="hs_watch_list_campaign_code field hs-form-field" style="display:none;" data-reactid=".hbspt-forms-0.0:$6.1:$watch_list_campaign_code"><label class="" placeholder="Enter your Watch List Campaign Code" for="watch_list_campaign_code-231f17cf-5711-4165-9046-952cc5e0d138" data-reactid=".hbspt-forms-0.0:$6.1:$watch_list_campaign_code.0"><span data-reactid=".hbspt-forms-0.0:$6.1:$watch_list_campaign_code.0.0">Watch List Campaign Code</span></label><legend class="hs-field-desc" style="display:none;" data-reactid=".hbspt-forms-0.0:$6.1:$watch_list_campaign_code.1"></legend><div class="input" data-reactid=".hbspt-forms-0.0:$6.1:$watch_list_campaign_code.$watch_list_campaign_code"><input name="watch_list_campaign_code" class="hs-input" value="" data-reactid=".hbspt-forms-0.0:$6.1:$watch_list_campaign_code.$watch_list_campaign_code.0" type="hidden"></div></div></fieldset><div class="hs_submit" data-reactid=".hbspt-forms-0.2"><div class="hs-field-desc" style="display:none;" data-reactid=".hbspt-forms-0.2.0"></div><div class="actions" data-reactid=".hbspt-forms-0.2.1"><input value="Submit" class="btn h-btn-size-xs h-btn-color-white h-btn-outlined" data-reactid=".hbspt-forms-0.2.1.0" type="submit"></div></div><input name="hs_context" value="{&quot;rumScriptExecuteTime&quot;:2089.38,&quot;rumServiceResponseTime&quot;:2475.925,&quot;rumFormRenderTime&quot;:387.16499999999996,&quot;rumTotalRequestTime&quot;:384.2349999999997,&quot;pageUrl&quot;:&quot;https://databricks.com/blog/2015/04/13/deep-dive-into-spark-sqls-catalyst-optimizer.html&quot;,&quot;pageTitle&quot;:&quot;Deep Dive into Spark SQL’s Catalyst Optimizer&quot;,&quot;isHostedOnHubspot&quot;:false,&quot;timestamp&quot;:1471567037892,&quot;userAgent&quot;:&quot;Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:41.0) Gecko/20100101 Firefox/41.0&quot;,&quot;referrer&quot;:&quot;https://www.google.com&quot;,&quot;hutk&quot;:&quot;3ba98cbc0fef56236cfe435289981bcd&quot;,&quot;originalEmbedContext&quot;:{&quot;portalId&quot;:&quot;438089&quot;,&quot;formId&quot;:&quot;231f17cf-5711-4165-9046-952cc5e0d138&quot;,&quot;css&quot;:&quot;&quot;,&quot;cssRequired&quot;:&quot;&quot;,&quot;target&quot;:&quot;#email-box-106 .js-email-tab-form&quot;,&quot;submitButtonClass&quot;:&quot;btn h-btn-size-xs h-btn-color-white h-btn-outlined&quot;},&quot;recentFieldsCookie&quot;:{},&quot;boolCheckBoxFields&quot;:&quot;&quot;,&quot;dateFields&quot;:&quot;&quot;,&quot;smartFields&quot;:{},&quot;urlParams&quot;:{},&quot;formValidity&quot;:{},&quot;correlationId&quot;:&quot;104c2f09-51ca-42bd-8781-186bd005a355&quot;,&quot;disableCookieSubmission&quot;:false}" data-reactid=".hbspt-forms-0.3" type="hidden"></form></div>
      </div>
    </div>
<script id="" type="text/javascript">(function(a,b,c,d,e){a=b.createElement(c);b=b.getElementsByTagName(c)[0];a.async=1;a.id=e;a.src=("https:"==document.location.protocol?"https://":"http://")+d;b.parentNode.insertBefore(a,b)})(window,document,"script","scripts.demandbase.com/xoRL8eto.min.js","demandbase_js_lib");</script><div style="display: none; visibility: hidden;"><script type="text/javascript">(function(a,c,d,e){if(!a.getElementById(d)){var b=a.createElement(c);a=a.getElementsByTagName(c)[0];b.id=d;b.src="//js.hs-analytics.net/analytics/"+Math.ceil(new Date/e)*e+"/438089.js";a.parentNode.insertBefore(b,a)}})(document,"script","hs-analytics",3E5);</script></div><script src="Deep%20Dive%20into%20Spark%20SQL%E2%80%99s%20Catalyst%20Optimizer_files/oct.js" id="" type="text/javascript"></script>
<script id="" type="text/javascript">!function(b,e,f,g,a,c,d){b.fbq||(a=b.fbq=function(){a.callMethod?a.callMethod.apply(a,arguments):a.queue.push(arguments)},b._fbq||(b._fbq=a),a.push=a,a.loaded=!0,a.version="2.0",a.queue=[],c=e.createElement(f),c.async=!0,c.src=g,d=e.getElementsByTagName(f)[0],d.parentNode.insertBefore(c,d))}(window,document,"script","//connect.facebook.net/en_US/fbevents.js");fbq("init","1723158351253812");fbq("track","PageView");</script>
<noscript><img height="1" width="1" style="display:none" src="https://www.facebook.com/tr?id=1723158351253812&amp;ev=PageView&amp;noscript=1"></noscript>

<script id="" type="text/javascript">twttr.conversion.trackPid("ntgt2",{tw_sale_amount:0,tw_order_quantity:0});</script><script src="Deep%20Dive%20into%20Spark%20SQL%E2%80%99s%20Catalyst%20Optimizer_files/adsct.js"></script>
<noscript>
  <img height="1" width="1" style="display:none;" alt="" src="https://analytics.twitter.com/i/adsct?txn_id=ntgt2&amp;p_id=Twitter&amp;tw_sale_amount=0&amp;tw_order_quantity=0">
  <img height="1" width="1" style="display:none;" alt="" src="//t.co/i/adsct?txn_id=ntgt2&amp;p_id=Twitter&amp;tw_sale_amount=0&amp;tw_order_quantity=0">
</noscript><iframe style="display: none;" id="db_ect" src="Deep%20Dive%20into%20Spark%20SQL%E2%80%99s%20Catalyst%20Optimizer_files/ect.html" height="0" width="0"></iframe></body></html>